<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>粤人无数</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="${basepath}/css/reset.css">
	<link rel="stylesheet" href="${basepath}/css/pub.css">
	<link rel="stylesheet" href="${basepath}/css/swiper.min.css">
	<link rel="stylesheet" href="${basepath}/css/chatMain.css">
	<script type="text/javascript" src="${basepath}/js/suit.js"></script>
	<script type="text/javascript" src="${basepath}/js/jquery-1.8.3.min.js"></script>
</head>
<body>
	<div id="wrap">
		<div id="top">
			<img id="prev" src="${basepath}/images/prev.png"></img>
			<div id="top_text">聊天吹水</div>
			<img id="add" src="${basepath}/images/yuyi.png" alt="">
		</div>
		<div id="content">
			<div class="banner"></div>
			<div class="swiper-container">
				<ul class="pagination">
					<li class="swiper-pagination-custom myPagination onShow">最新</li>
					<li class="swiper-pagination-custom myPagination">最火</li>
					<li class="swiper-pagination-custom myPagination">最热</li>
				</ul>
				<div class="swiper-wrapper">
					<ul class="swiper-slide">
					#foreach($element in $list)
						<li class="new_li con_info">
							<div class="user_info">
								<div class="info_img"><img src="${basepath}/uplod/${element.userimg}" class="info_img"></img></div>
								<div class="user_rightBox">
								#if(${element.sex}=="女")
									<img src="${basepath}/images/girl.png" class="sex_img"></img>
								#else
								   <img src="${basepath}/images/sex.png" class="sex_img"></img>
								#end
									<span class="user_name">${element.name}</span>
									<div class="info_time"><var>${element.time}</var></div>
								</div>
							</div>
							<div class="content_info">
								<a href="${basepath}/chatInfo.html">
									<div class="content_img"><img src="${basepath}/uplod/${element.userimg}" class="content_img"></div>
									<div class="content_rightBox">
										<h1>${element.title}</h1>
										<h2>${element.comment}</h2>
									</div>
								</a>
									<div class="controll">
										<div class="upvote" >
										 <input type="hidden" id="publishId" value="${element.publishId}">
                                         <input type="hidden" id="name" value="${element.name}">
										</div>
										<!-- <img class="upvote" src="../../images/upvote.png" alt="">
										<img class="upvote2" src="../../images/AVQ@VUSZD4517[ORS[8I1KM.png" alt=""> -->
										<img class="reply" src="${basepath}/images/reply.png" alt="">
									</div>
							</div>
						</li>
						 #end
					</ul>
					<ul class="swiper-slide">
						<li class="fire_li con_info">
							<div class="user_info">
								<div class="info_img"></div>
								<div class="user_rightBox">
									<img src="${basepath}/images/sex.png" class="sex_img"></img>
									<span class="user_name">我的名字</span>
									<div class="info_time"><var>1</var>小时前</div>
								</div>
							</div>
							<div class="content_info">
								<a href="${basepath}/chatInfo.html">
									<div class="content_img"></div>
									<div class="content_rightBox">
										<h1>北京真真正中重中之重</h1>
										<h2>啊搜的大师萨芬大</h2>
									</div>
								</a>
									<div class="controll">
										<div class="upvote"></div>
										<!-- <img class="upvote" src="../../images/upvote.png" alt="">
										<img class="upvote2" src="../../images/AVQ@VUSZD4517[ORS[8I1KM.png" alt=""> -->
										<img class="reply" src="${basepath}/images/reply.png" alt="">
									</div>
							</div>
						</li>
					</ul>
					<ul class="swiper-slide">
						<li class="hot_li con_info">
							<div class="user_info">
								<div class="info_img"></div>
								<div class="user_rightBox">
									<img src="${basepath}/images/sex.png" class="sex_img"></img>
									<span class="user_name">我的名字</span>
									<div class="info_time"><var>1</var>小时前</div>
								</div>
							</div>
							<div class="content_info">
								<a href="${basepath}/chatInfo.html">
									<div class="content_img"></div>
									<div class="content_rightBox">
										<h1>北京真真正中重中之重</h1>
										<h2>啊搜的大师萨芬大</h2>
									</div>
								</a>
									<div class="controll">
										<div class="upvote"></div>
										<!-- <img class="upvote" src="../../images/upvote.png" alt="">
										<img class="upvote2" src="../../images/AVQ@VUSZD4517[ORS[8I1KM.png" alt=""> -->
										<img class="reply" src="${basepath}/images/reply.png" alt="">
									</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="${basepath}/js/swiper.min.js"></script>
	<script>
	      var a=0;
		$('.upvote').click(function(){
			
			if (a==0) {
               $(this).removeClass()
			   $(this).addClass('upvote2')
			   ajax($('#publishId').val(),$('#name').val());
			   function ajax(publish_id,username){
				$.ajax({
			   url:"chatajax.do",
			   type:"post",
			   data:{
				"publish_id":publish_id,
				"username":username
			   },
			   dataType:"json",
			success:function(data){
                 alert(data.username);
			},
			error:function(){
				 alert("错了哦");
			}
		     });
		    }
			   a=1;
			}else{
               $(this).removeClass()
			   $(this).addClass('upvote')
			   a=0;
			    ajax($('#publishId').val(),$('#name').val());
			   function ajax(publish_id,username){
				$.ajax({
			   url:"dchatajax.html",
			   type:"post",
			   data:{
				"publish_id":publish_id,
				"username":username
			   },
			   dataType:"json",
			success:function(data){
                 // alert(data.username);
			},
			error:function(){
				// alert("错了哦");
			}
		     });
		    }
			}
			
             
		})
        
		var mySwiper = new Swiper ('.swiper-container', {
			direction: 'horizontal',
			pagination: '.pagination',
			paginationType : 'custom'
		});
		var p=document.getElementsByClassName('myPagination');
		var slide=document.getElementsByClassName('swiper-slide');
		var wrapper=document.getElementsByClassName('swiper-wrapper')[0];
		for(var i=0;i<p.length;i++){
			p[i].index=i;
			p[i].addEventListener('touchstart',function(e){
				mySwiper.slideTo(this.index,300,false);
			})
		}
		var add=document.getElementById('add');
		add.addEventListener('touchend',function(){
			self.location='${basepath}/publishChat.html';
		})
		var prev=document.getElementById('prev');
		prev.addEventListener('touchend',function(){
			self.location='${basepath}/index.html';
		})
		for(var i=0;i<p.length;i++){
			p[i].addEventListener('touchstart',function(){
				for(var j=0;j<p.length;j++){
					p[j].classList.remove('onShow');
				}
				this.classList.add('onShow');
			})
		}
		wrapper.addEventListener('touchend',function(e){
			for(var i=0;i<p.length;i++){
				p[i].classList.remove('onShow');
			}
			var timr=setTimeout(function(){
				input=wrapper.style.transform;
				if(!input){
					input=0;
				}else{
					input=input.match(/\((\S*)/)[1];
					input=input.match(/^.*?p/);
					input=input[0].slice(0,-1);
					input=Math.abs(input);
					input=Math.round(input/window.screen.width);
				}
				p[input].classList.add('onShow');
				clearTimeout(timr);
			})
		})

		var con_info=document.getElementsByClassName('con_info');
		var yX=0;
		var oX=0;
		var yY=0;
		var oY=0;
		for(var i=0;i<con_info.length;i++){
			var f=1;
			con_info[i].addEventListener('touchend',function(e){
				oX=e.changedTouches[0].clientX;
				oY=e.changedTouches[0].clientY;
				/*if(!f){
					return false;
				}else{
					self.location='./chatInfo.html';
				}*/
			})
			con_info[i].addEventListener('touchmove',function(e){
				if(Math.abs(yX-oX)>11||Math.abs(yY-oY)>11){
					f=0;
				}else{
					f=1;
				};
			})
			con_info[i].addEventListener('touchstart',function(e){
				yX=e.changedTouches[0].clientX;
				yY=e.changedTouches[0].clientY;
				f=1;
			})

		}
	</script>
</body>
</html>